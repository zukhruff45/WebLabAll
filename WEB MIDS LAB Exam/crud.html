<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Yoga Studio CRUD App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    body { background: #f8fafc; }
    .crud-card { max-width: 900px; margin: 2rem auto; }
    .table th, .table td { vertical-align: middle; }
    .card-form { background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(40,167,69,0.07); padding: 1.5rem; }
  </style>
</head>
<body>
  <!-- Header with navigation -->
  <header class="site-header">
    <nav aria-label="Main Navigation">
      <div class="container header-flex">
        <a href="index.html" class="logo" aria-label="Yoga Studio Home">Yoga Studio</a>
        <ul class="nav-list">
          <li><a href="index.html#features">Features</a></li>
          <li><a href="index.html#testimonials">Testimonials</a></li>
          <li><a href="index.html#contact">Contact</a></li>
          <li><a href="crud.html">CRUD</a></li>
        </ul>
      </div>
    </nav>
  </header>
  <main>
    <div class="container">
      <div class="crud-card card shadow">
        <div class="card-body">
          <h2 class="card-title mb-4 text-center">Manage Posts</h2>
          <form id="postForm" class="card-form mb-4">
            <input type="hidden" id="postId">
            <div class="mb-3">
              <label for="postTitle" class="form-label">Title</label>
              <input type="text" class="form-control" id="postTitle" required>
            </div>
            <div class="mb-3">
              <label for="postBody" class="form-label">Body</label>
              <textarea class="form-control" id="postBody" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-success me-2" id="saveBtn">Save Post</button>
            <button type="button" class="btn btn-secondary" id="cancelEdit" style="display: none;">Cancel</button>
          </form>
          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Body</th>
                  <th style="width:150px;">Actions</th>
                </tr>
              </thead>
              <tbody id="postsTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer class="text-center py-4 text-muted">
    Â© 2025 Yoga Studio. All rights reserved.
  </footer>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const API_URL = "https://jsonplaceholder.typicode.com/posts";
    const $tableBody = $('#postsTable');
    const $form = $('#postForm');
    const $title = $('#postTitle');
    const $body = $('#postBody');
    const $id = $('#postId');
    const $cancelEdit = $('#cancelEdit');
    let loading = false;

    // Helper: Show loader (optional, can add spinner)
    function setLoading(state) {
      loading = state;
      if(state) $form.find('button').prop('disabled', true);
      else $form.find('button').prop('disabled', false);
    }

    // Read (Fetch posts)
    function fetchPosts() {
      setLoading(true);
      $.get(API_URL, function(data){
        $tableBody.empty();
        data.slice(0,8).forEach(post => {
          $tableBody.append(`
            <tr data-id="${post.id}">
              <td>${post.id}</td>
              <td>${post.title}</td>
              <td>${post.body}</td>
              <td>
                <button class="btn btn-sm btn-warning editBtn">Edit</button>
                <button class="btn btn-sm btn-danger deleteBtn">Delete</button>
              </td>
            </tr>
          `);
        });
      }).always(() => setLoading(false));
    }
    fetchPosts();

    // Create or Update
    $form.on('submit', function(e){
      e.preventDefault();
      let title = $title.val().trim();
      let body = $body.val().trim();
      let id = $id.val();

      if(!title || !body){
        alert("Title and body are required!");
        return;
      }

      setLoading(true);

      if(id){ // Update
        $.ajax({
          url: `${API_URL}/${id}`,
          method: "PUT",
          data: JSON.stringify({ title, body, userId: 1 }),
          contentType: "application/json"
        }).done(function(updated){
          let $row = $tableBody.find(`tr[data-id="${id}"]`);
          $row.find('td:eq(1)').text(updated.title);
          $row.find('td:eq(2)').text(updated.body);
          $form[0].reset();
          $id.val('');
          $cancelEdit.hide();
        }).fail(function(){ alert("Update failed."); })
        .always(() => setLoading(false));
      }else{ // Create
        $.ajax({
          url: API_URL,
          method: "POST",
          data: JSON.stringify({ title, body, userId: 1 }),
          contentType: "application/json"
        }).done(function(newPost){
          let fakeId = Date.now();
          $tableBody.prepend(`
            <tr data-id="${fakeId}">
              <td>${fakeId}</td>
              <td>${newPost.title}</td>
              <td>${newPost.body}</td>
              <td>
                <button class="btn btn-sm btn-warning editBtn">Edit</button>
                <button class="btn btn-sm btn-danger deleteBtn">Delete</button>
              </td>
            </tr>
          `);
          $form[0].reset();
        }).fail(function(){ alert("Create failed."); })
        .always(() => setLoading(false));
      }
    });

    // Edit
    $tableBody.on('click', '.editBtn', function(){
      let $row = $(this).closest('tr');
      $id.val($row.data('id'));
      $title.val($row.find('td:eq(1)').text());
      $body.val($row.find('td:eq(2)').text());
      $cancelEdit.show();
    });

    // Cancel Edit
    $cancelEdit.on('click', function(){
      $form[0].reset();
      $id.val('');
      $cancelEdit.hide();
    });

    // Delete
    $tableBody.on('click', '.deleteBtn', function(){
      let $row = $(this).closest('tr');
      let id = $row.data('id');
      if(confirm("Are you sure you want to delete this post?")){
        setLoading(true);
        $.ajax({
          url: `${API_URL}/${id}`,
          method: "DELETE"
        }).done(function(){
          $row.remove();
        }).fail(function(){ alert("Delete failed."); })
        .always(() => setLoading(false));
      }
    });
  </script>
</body>
</html>